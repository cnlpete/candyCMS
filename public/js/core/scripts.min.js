function show(a){$(a).show();if($("#js-flash_success")||$("#js-flash_error")){hide(a,10000)}}function hide(a,b){$(a).delay(b).slideUp()}$.fn.toggleOpacity=function(a){if(a){this.stop(true,true).animate({opacity:1})}else{this.stop(true,true).animate({opacity:0.25})}};function quote(e,b){var a=$("#js-create_commment_text");var f=a.val();var c=$("#"+b).html();var d="[quote="+e+"]"+c+"[/quote]\n";a.val(f+d);if($.mobile){$.mobile.silentScroll(a.offset().top)}return false}function stripNoAlphaChars(a){a=a.replace(/ /g,"_");a=a.replace(/Ä/g,"Ae");a=a.replace(/ä/g,"ae");a=a.replace(/Ö/g,"Oe");a=a.replace(/ö/g,"oe");a=a.replace(/Ü/g,"Ue");a=a.replace(/ü/g,"ue");a=a.replace(/ß/g,"ss");a=a.replace(/\W/g,"_");return a}function confirmDestroy(a){if(confirm(lang.confirm_destroy)){parent.location.href=a}}function countCharLength(b,a){var c=a-$(b).val().length;$(b).next().html(c)}function getSizeOfFiles(c){if(typeof window.FileReader!=="function"||!c.files||!c.files[0]){return 0}var d=0;var b=c.files.length;for(var a=0;a<b;a++){d=d+c.files[a].size}return d}function checkFileSize(c,b,a){var e=getSizeOfFiles(c[0]);var d=c.closest(".control-group");var f="file-input-help";if(e>b){d.addClass("alert alert-error");if($("#"+f).length){$("#"+f).removeClass("invisible")}else{var g=$('<span class="help-inline" id="'+f+'">'+a+"</span>");c.after(g)}}else{$("#"+f).fadeOut(function(){$(this).remove();if(!d.find(".help-inline").length){d.removeClass("alert alert-error")}})}}var iCounter=0;function enableInfiniteScroll(a,b,c,d){$(a).infinitescroll({navSelector:"div.pagination",nextSelector:"div.pagination a:first",itemSelector:b,loading:{msgText:"",img:d+"/candy.global/loading.gif",finishedMsg:"",selector:"div.js-pagination",finished:function(f){f.loading.msg.fadeOut(f.loading.speed);iCounter=iCounter+1;if(iCounter%c==0){f.contentSelector.infinitescroll("pause");var e=$('<a alt="{$lang.pages.more}" data-role="button" class="btn">{$lang.pages.more}</a>');e.click(function(){$(this).fadeOut(f.loading.speed,function(){f.contentSelector.infinitescroll("resume")})});$(f.loading.selector).append(e)}return true}},animate:true})}if($("#js-flash_success, #js-flash_error, #js-flash_warning").length){show("#js-flash_message")}$("#js-flash_success, #js-flash_error, #js-flash_warning").click(function(){hide(this,0)});if($(".js-tooltip").length){$(".js-tooltip").tooltip()}if($("p.error").length){$("p.error").tooltip()}function prepareForUpload(){$("#js-progress_bar").css("width","0%");$("#js-progress").toggle()}function upload(k,b,g,l,j,h){$(k).attr("disabled");var a=document.querySelector("#input-"+l).files;var d=new FormData();for(var f=0,c;c=a[f];++f){d.append("file["+f+"]",c)}if(j!==""){$("#input-"+j).click(function(){$(this).parents().eq(2).removeClass("alert alert-error");$(".help-inline").remove()});if($("#input-"+j).is(":checkbox")){d.append(j,$("#input-"+j).attr("checked"))}else{d.append(g+"["+j+"]",$("#input-"+j).val())}}var m=new XMLHttpRequest();m.open("POST",b,true);m.upload.onprogress=function(n){if(n.lengthComputable){var i=(n.loaded/n.total)*100;$("#js-progress_bar").css("width",i+"%")}};m.onload=function(){$("#js-progress").toggle();$(k).removeAttr("disabled");var e=JSON.parse(this.response);if(e.success==true){$(".control-group").removeClass("alert alert-error");$("#input-"+l).val("");$("#input-"+j).val("");var i=lang.upload_successful;if(g=="medias"){i=i+" "+lang.reloading;$("#medias .form-horizontal").toggle()}if(g=="users"){$("#js-avatar_thumb").attr("src",e.dataUrl);$("#js-avatar_link").attr("href",e.fileUrl)}showFlashMessage("success",i);if(h==true){setTimeout(function(){location.reload()},3000)}}else{if(e.error[j]){$("#input-"+j).parents().eq(2).addClass("alert alert-error");$("#input-"+j).parents().eq(1).append("<span class='help-inline'>"+e.error[j]+"</span>")}if(e.error[l]){$("#input-"+l).parents().eq(1).addClass("alert alert-error");$("#input-"+l).next().html(e.error[l])}showFlashMessage("error",lang.upload_error)}};m.send(d)}function showFlashMessage(b,a){$("#js-flash_message").show().children().attr("id","js-flash_"+b).attr("class","alert alert-"+b);$("#js-flash_"+b+" a").remove();$("#js-flash_"+b+" p").html(a);$("#js-flash_message").delay("10000").slideUp()};