function show(a){$(a).show();if($("#js-flash_success")||$("#js-flash_error")){hide(a,10000)}}function hide(a,b){$(a).delay(b).slideUp()}$.fn.toggleOpacity=function(a){if(a){this.stop(true,true).animate({opacity:1})}else{this.stop(true,true).animate({opacity:0.25})}};function quote(e,b){var a=$("#js-create_commment_text");var f=a.val();var c=$("#"+b).html();var d="[quote="+e+"]"+c+"[/quote]\n";a.val(f+d);if($.mobile){$.mobile.silentScroll(a.offset().top)}return false}function stripNoAlphaChars(a){a=a.replace(/ /g,"_");a=a.replace(/Ä/g,"Ae");a=a.replace(/ä/g,"ae");a=a.replace(/Ö/g,"Oe");a=a.replace(/ö/g,"oe");a=a.replace(/Ü/g,"Ue");a=a.replace(/ü/g,"ue");a=a.replace(/ß/g,"ss");a=a.replace(/\W/g,"_");return a}function confirmDestroy(a){if(confirm(lang.confirm_destroy)){parent.location.href=a}}function countCharLength(b,a){var c=a-$(b).val().length;$(b).next().html(c)}function getSizeOfFiles(c){if(typeof window.FileReader!=="function"||!c.files||!c.files[0]){return 0}var d=0;var b=c.files.length;for(var a=0;a<b;a++){d=d+c.files[a].size}return d}function checkFileSize(c,b,a){var e=getSizeOfFiles(c[0]);var d=c.closest(".control-group");var f="file-input-help";if(e>b){d.addClass("alert alert-error");if($("#"+f).length){$("#"+f).removeClass("invisible")}else{var g=$('<span class="help-inline" id="'+f+'">'+a+"</span>");c.after(g)}}else{$("#"+f).fadeOut(function(){$(this).remove();if(!d.find(".help-inline").length){d.removeClass("alert alert-error")}})}}var iCounter=0;function enableInfiniteScroll(a,b,c,d){$(a).infinitescroll({navSelector:"div.pagination",nextSelector:"div.pagination a:first",itemSelector:b,loading:{msgText:"",img:d+"/candy.global/loading.gif",finishedMsg:"",selector:"div.js-pagination",finished:function(f){f.loading.msg.fadeOut(f.loading.speed);iCounter=iCounter+1;if(iCounter%c==0){f.contentSelector.infinitescroll("pause");var e=$('<a alt="{$lang.pages.more}" data-role="button" class="btn">{$lang.pages.more}</a>');e.click(function(){$(this).fadeOut(f.loading.speed,function(){f.contentSelector.infinitescroll("resume")})});$(f.loading.selector).append(e)}return true}},animate:true})}if($("#js-flash_success, #js-flash_error, #js-flash_warning").length>0){show("#js-flash_message")}$("#js-flash_success, #js-flash_error, #js-flash_warning").click(function(){hide(this,0)});if($(".js-tooltip").length){$(".js-tooltip").tooltip()}if($("p.error").length){$("p.error").tooltip()}function prepareForUpload(){$("#js-progress_bar").css("width","0%");$("#js-progress").toggle()}function upload(h,a,d,i,g,f){$(h).attr("disabled");var c=document.querySelector("#input-"+i).files[0];var b=new FormData();b.append("file",c);if(g!==""){$("#input-"+g).click(function(){$(this).parents().eq(2).removeClass("alert alert-error");$(".help-inline").remove()});if($("#input-"+g).is(":checkbox")){b.append(g,$("#input-"+g).attr("checked"))}else{b.append(d+"["+g+"]",$("#input-"+g).val())}}var j=new XMLHttpRequest();j.open("POST",a,true);j.upload.onprogress=function(l){if(l.lengthComputable){var k=(l.loaded/l.total)*100;$("#js-progress_bar").css("width",k+"%")}};j.onload=function(){$("#js-progress").toggle();$(h).removeAttr("disabled");var e=JSON.parse(this.response);console.log(e);if(e.success==true){if($("#js-avatar_thumb")){$("#js-avatar_thumb").attr("src",e.dataUrl)}if($("#js-avatar_link")){$("#js-avatar_link").attr("href",e.fileUrl)}$("#medias .form-horizontal").toggle();$(".control-group").removeClass("alert alert-error");$("#input-"+i).val("");$("#input-"+g).val("");showFlashMessage("success",lang.upload_successful);if($(f).length>0){$("#"+d).delay("5000").load(f+"?ajax=1")}}else{if(e.error[g]){$("#input-"+g).parents().eq(2).addClass("alert alert-error");$("#input-"+g).parents().eq(1).append("<span class='help-inline'>"+e.error[g]+"</span>")}if(e.error[i]){$("#input-"+i).parents().eq(1).addClass("alert alert-error");$("#input-"+i).next().html(e.error[i])}showFlashMessage("error",lang.upload_error)}};j.send(b)}function showFlashMessage(b,a){$("#js-flash_message").show().children().attr("id","js-flash_"+b).attr("class","alert alert-"+b);$("#js-flash_"+b+" a").remove();$("#js-flash_"+b+" p").html(a);$("#js-flash_message").delay("10000").slideUp()};